{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"D:/Meta Melon Data/Schengen-Expert/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"D:/Meta Melon Data/Schengen-Expert/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"D:/Meta Melon Data/Schengen-Expert/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"D:/Meta Melon Data/Schengen-Expert/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport styles from '@/styles/singleDestFares.module.css';\nimport { useRouter } from 'next/router';\nimport Layout from '../../../components/layout';\nimport FareCard from '@/components/common/fareCard';\nimport { countries } from 'utils/data';\nimport Searchbar from '@/components/searchEngine'; // firebase\n\nimport { collection, query, where, getDocs, limit, startAfter } from 'firebase/firestore';\nimport { db } from '../../../config/firebaseConfig';\nimport { convertString } from '../../../utils/helpers';\nimport { Typography, Skeleton, ThemeProvider, Button } from '@mui/material';\nimport InquiryForm from '@/components/common/inquiryForm';\nimport LoadingButton from '@mui/lab/LoadingButton';\nimport { theme } from '@/styles/theme';\nexport default function SingleDestination() {\n  var router = useRouter();\n  var destSlug = router.query.destSlug;\n\n  var _useState = useState([]),\n      fares = _useState[0],\n      setFares = _useState[1];\n\n  var _useState2 = useState(false),\n      isEmpty = _useState2[0],\n      setIsEmpty = _useState2[1];\n\n  var _useState3 = useState(0),\n      skip = _useState3[0],\n      setSkip = _useState3[1];\n\n  var _useState4 = useState(),\n      lastDocu = _useState4[0],\n      setLastDocu = _useState4[1];\n\n  var _useState5 = useState(),\n      fetching = _useState5[0],\n      setFetching = _useState5[1];\n\n  var _useState6 = useState(false),\n      blockApi = _useState6[0],\n      setBlockApi = _useState6[1];\n\n  var _useState7 = useState(null),\n      footerData = _useState7[0],\n      setFooterData = _useState7[1];\n\n  var _useState8 = useState(null),\n      airline = _useState8[0],\n      setAirline = _useState8[1];\n\n  var _useState9 = useState(null),\n      destData = _useState9[0],\n      setDestData = _useState9[1];\n\n  var getData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var arrOfData, q, querySnapshot, _arrOfData, _q, _querySnapshot;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (blockApi) {\n                _context.next = 26;\n                break;\n              }\n\n              setFetching(true);\n\n              if (!(fares.length == 0)) {\n                _context.next = 15;\n                break;\n              }\n\n              arrOfData = [];\n              q = query(collection(db, 'fares'), where('destCountry.name', '==', destSlug), limit(10));\n              _context.next = 7;\n              return getDocs(q);\n\n            case 7:\n              querySnapshot = _context.sent;\n              setLastDocu(querySnapshot.docs[querySnapshot.docs.length - 1]);\n              querySnapshot.forEach(function (doc) {\n                arrOfData.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                  _id: doc.id\n                }));\n              });\n              setFares(arrOfData); // console.log(arrOfData);\n\n              if (arrOfData.length === 0) {\n                setIsEmpty(true);\n              }\n\n              if (arrOfData.length < 10) {\n                setBlockApi(true);\n              }\n\n              _context.next = 25;\n              break;\n\n            case 15:\n              if (!(fares.length > 0)) {\n                _context.next = 25;\n                break;\n              }\n\n              _arrOfData = [];\n              _q = query(collection(db, 'fares'), where('destCountry.name', '==', destSlug), startAfter(lastDocu), limit(10));\n              _context.next = 20;\n              return getDocs(_q);\n\n            case 20:\n              _querySnapshot = _context.sent;\n              setLastDocu(_querySnapshot.docs[_querySnapshot.docs.length - 1]);\n\n              _querySnapshot.forEach(function (doc) {\n                _arrOfData.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                  _id: doc.id\n                }));\n              });\n\n              setFares([].concat(_toConsumableArray(fares), _arrOfData));\n\n              if (_arrOfData.length < 10) {\n                setBlockApi(true);\n              }\n\n            case 25:\n              setFetching(false);\n\n            case 26:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getFooterData = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var index, arrOfData, q, querySnapshot;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              index = Math.floor(Math.random() * 13) + 1;\n              arrOfData = [];\n\n              if (!index) {\n                _context2.next = 9;\n                break;\n              }\n\n              q = query(collection(db, 'airlinesFooter'), where('index', '==', index.toString()));\n              _context2.next = 6;\n              return getDocs(q);\n\n            case 6:\n              querySnapshot = _context2.sent;\n              querySnapshot.forEach(function (doc) {\n                arrOfData.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                  _id: doc.id\n                }));\n              });\n              setFooterData(arrOfData[0]); // console.log(arrOfData[0]);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getFooterData() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var getAirline = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var index, arrOfData, q, querySnapshot;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              index = Math.floor(Math.random() * 33) + 1; // console.log(index);\n\n              arrOfData = [];\n\n              if (!index) {\n                _context3.next = 9;\n                break;\n              }\n\n              q = query(collection(db, 'airlines'), where('index', '==', index.toString()));\n              _context3.next = 6;\n              return getDocs(q);\n\n            case 6:\n              querySnapshot = _context3.sent;\n              querySnapshot.forEach(function (doc) {\n                arrOfData.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                  _id: doc.id\n                }));\n              });\n              setAirline(arrOfData[0]); // console.log(arrOfData[0]);\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function getAirline() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var getDestination = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var arrOfData, q, querySnapshot;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              arrOfData = [];\n              q = query(collection(db, 'destinations'), where('name', '==', destSlug));\n              _context4.next = 4;\n              return getDocs(q);\n\n            case 4:\n              querySnapshot = _context4.sent;\n              querySnapshot.forEach(function (doc) {\n                arrOfData.push(_objectSpread(_objectSpread({}, doc.data()), {}, {\n                  _id: doc.id\n                }));\n              });\n              setDestData(arrOfData[0]);\n\n            case 7:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function getDestination() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var bannerStyles = {\n    backgroundImage: destData ? \"url(\".concat(destData.banner, \")\") : '',\n    marginTop: '4.5rem',\n    width: '100%',\n    height: '15rem',\n    backgroundSize: 'cover',\n    backgroundPosition: 'center',\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    color: 'white',\n    textShadow: '2px 2px black'\n  };\n  useEffect(function () {\n    if (destSlug) {\n      getData();\n      getFooterData();\n      getAirline();\n      getDestination();\n    }\n  }, [destSlug]);\n  useEffect(function () {\n    if (destSlug) {\n      getData();\n    }\n  }, [skip]); // console.log(destSlug);\n  // console.log(fares);\n  // console.log(destData);\n\n  return /*#__PURE__*/_jsx(Layout, {\n    title: 'Destinations',\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.faresPage,\n      children: [destData ? /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          style: bannerStyles,\n          children: /*#__PURE__*/_jsx(\"h1\", {\n            children: convertString(destSlug)\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            marginTop: '2rem'\n          },\n          children: /*#__PURE__*/_jsx(Searchbar, {})\n        })]\n      }) : /*#__PURE__*/_jsx(_Fragment, {\n        children: destSlug && /*#__PURE__*/_jsx(\"div\", {\n          className: styles.banner,\n          children: /*#__PURE__*/_jsx(\"h1\", {\n            children: convertString(destSlug)\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: !isEmpty ? styles.faresContainer : styles.displayNone,\n        children: fares.length > 0 ? /*#__PURE__*/_jsx(_Fragment, {\n          children: fares.map(function (fare, i) {\n            return /*#__PURE__*/_jsx(FareCard, {\n              data: fare\n            }, i);\n          })\n        }) : /*#__PURE__*/_jsx(_Fragment, {\n          children: Array(6).fill(true).map(function (item, i) {\n            return /*#__PURE__*/_jsxs(\"div\", {\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: styles.fareSkeletonForPC,\n                children: /*#__PURE__*/_jsx(Skeleton, {\n                  variant: \"rectangular\",\n                  width: 560,\n                  height: 215\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: styles.fareSkeletonForPhone,\n                children: /*#__PURE__*/_jsx(Skeleton, {\n                  variant: \"rectangular\",\n                  width: 280,\n                  height: 480\n                })\n              })]\n            }, i);\n          })\n        })\n      }), /*#__PURE__*/_jsx(ThemeProvider, {\n        theme: theme,\n        children: fares.length > 0 && /*#__PURE__*/_jsx(LoadingButton, {\n          sx: {\n            margin: '1rem'\n          },\n          loading: fetching,\n          disabled: blockApi,\n          onClick: function onClick() {\n            return setSkip(skip + 1);\n          },\n          variant: \"contained\",\n          children: blockApi ? 'No More' : 'More'\n        })\n      }), /*#__PURE__*/_jsx(_Fragment, {\n        children: isEmpty && /*#__PURE__*/_jsx(InquiryForm, {\n          h1: \"Send Inquiry\"\n        })\n      }), destData && /*#__PURE__*/_jsx(\"div\", {\n        className: styles.details // contentEditable=\"true\"\n        ,\n        dangerouslySetInnerHTML: {\n          __html: destData === null || destData === void 0 ? void 0 : destData.details\n        }\n      }), footerData && /*#__PURE__*/_jsx(\"div\", {\n        className: styles.airlineFooterContainer,\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.airlineFooter,\n          children: [/*#__PURE__*/_jsx(\"h2\", {\n            children: footerData.mainTxt\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: styles.airlineFooter__cards,\n            children: footerData.cards.map(function (item, i) {\n              return /*#__PURE__*/_jsxs(\"div\", {\n                className: styles.airlineFooter__card,\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: styles.card__img,\n                  children: /*#__PURE__*/_jsx(\"img\", {\n                    src: item.img,\n                    alt: \"airlineFooter card img\"\n                  })\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: styles.card__txt,\n                  children: [/*#__PURE__*/_jsx(\"h4\", {\n                    children: item.heading\n                  }), /*#__PURE__*/_jsx(\"p\", {\n                    children: item.txt\n                  })]\n                })]\n              }, i);\n            })\n          })]\n        })\n      }), airline && /*#__PURE__*/_jsx(\"div\", {\n        className: styles.footerBanner,\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: styles.bannerImg,\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: airline.banner,\n            alt: \"\".concat(airline.name, \" image\")\n          })\n        })\n      })]\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}